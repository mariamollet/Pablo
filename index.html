<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Operaci√≥n Cena Secreta</title>
  <style>
    :root{
      --bg: #f6f1e8;        /* beige suave */
      --paper: #ffffff;     /* tarjeta */
      --ink: #1b1b1b;       /* texto principal */
      --muted: #5f5a52;     /* texto secundario */
      --line: #e8dfd2;      /* l√≠neas */
      --accent: #b99663;    /* dorado-beige */
      --accent2:#8a7352;    /* acento oscuro */
      --shadow: 0 12px 36px rgba(22,18,12,.08);
      --r: 18px;
      --r2: 14px;
      --maxw: 880px;
      --serif: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(185,150,99,.18), transparent 60%),
        radial-gradient(900px 600px at 90% 70%, rgba(120,90,55,.10), transparent 58%),
        var(--bg);
      color: var(--ink);
      font-family: var(--sans);
      display:flex;
      justify-content:center;
      padding: 32px 14px;
    }

    .wrap{ width:100%; max-width: var(--maxw); }
    .card{
      background: rgba(255,255,255,.86);
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(6px);
    }

    header{
      padding: 28px 26px 18px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.72));
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 8px 12px;
      border: 1px solid rgba(185,150,99,.35);
      border-radius: 999px;
      color: var(--accent2);
      background: rgba(185,150,99,.10);
      font-weight: 650;
      letter-spacing: .2px;
      font-size: 13px;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background: var(--accent);
      box-shadow: 0 0 0 4px rgba(185,150,99,.12);
    }

    h1{
      margin: 14px 0 8px;
      font-family: var(--serif);
      font-weight: 750;
      letter-spacing: .2px;
      font-size: clamp(28px, 3.3vw, 40px);
      line-height: 1.08;
    }

    .lead{
      margin: 0;
      color: var(--muted);
      line-height: 1.65;
      font-size: 16px;
      max-width: 78ch;
    }
    .lead strong{ color: var(--ink); }

    main{ padding: 22px 26px 28px; }

    .panel{
      background: var(--paper);
      border: 1px solid var(--line);
      border-radius: var(--r2);
      padding: 18px 16px;
    }

    .rules{
      margin: 10px 0 0;
      padding: 0;
      list-style:none;
      color: var(--muted);
      line-height: 1.6;
      font-size: 14.5px;
      display:grid;
      gap: 6px;
    }
    .rules li::before{
      content:"‚Ä¢";
      color: var(--accent);
      margin-right: 10px;
    }

    .row{
      display:flex;
      gap: 12px;
      flex-wrap:wrap;
      margin-top: 16px;
      align-items:center;
    }

    button{
      font-family: inherit;
      border-radius: 999px;
      border: 1px solid rgba(185,150,99,.45);
      background: linear-gradient(180deg, rgba(185,150,99,.20), rgba(185,150,99,.10));
      color: var(--ink);
      padding: 12px 16px;
      cursor:pointer;
      transition: transform .08s ease, background .14s ease, border-color .14s ease;
      font-weight: 700;
      letter-spacing: .15px;
    }
    button:hover{
      transform: translateY(-1px);
      border-color: rgba(185,150,99,.70);
      background: linear-gradient(180deg, rgba(185,150,99,.26), rgba(185,150,99,.12));
    }
    button:active{ transform: translateY(0) scale(.99); }

    .ghost{
      border-color: rgba(0,0,0,.10);
      background: transparent;
      color: var(--muted);
      font-weight: 650;
    }
    .ghost:hover{
      border-color: rgba(0,0,0,.16);
      background: rgba(0,0,0,.03);
      transform: translateY(-1px);
    }

    .progress{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 12px;
      color: var(--muted);
      font-size: 13px;
      margin-bottom: 12px;
    }
    .bar{
      flex:1;
      height: 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.05);
      border: 1px solid rgba(0,0,0,.06);
      overflow:hidden;
    }
    .fill{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(185,150,99,.35), rgba(185,150,99,.90));
      transition: width .22s ease;
    }

    .q{
      margin: 6px 0 12px;
      font-size: 18px;
      line-height: 1.4;
      font-weight: 800;
      letter-spacing: .1px;
    }

    .answers{
      display:grid;
      gap: 10px;
      margin-top: 10px;
    }

    .answer{
      width:100%;
      text-align:left;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.08);
      background: rgba(250,248,245,.95);
      padding: 14px 14px;
      font-weight: 750;
    }
    .answer:hover{
      border-color: rgba(185,150,99,.65);
      background: rgba(255,255,255,.98);
    }
    .answer small{
      display:block;
      margin-top: 6px;
      color: var(--muted);
      font-weight: 600;
      line-height: 1.4;
    }

    .resultCode{
      display:inline-block;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(185,150,99,.45);
      background: rgba(185,150,99,.12);
      color: var(--accent2);
      font-weight: 900;
      letter-spacing: .7px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    footer{
      padding: 14px 26px 20px;
      border-top: 1px solid var(--line);
      color: rgba(27,27,27,.55);
      font-size: 12.5px;
      display:flex;
      justify-content:space-between;
      gap: 12px;
    }

    @media (max-width:520px){
      header, main, footer{ padding-left:16px; padding-right:16px; }
      .q{ font-size: 16.5px; }
      .answer{ border-radius: 12px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="pill"><span class="dot"></span> Operaci√≥n Cena Secreta</div>
        <h1>Pablo, enhorabuena üèÜ</h1>
        <p class="lead">
          S√© que te han dado un premio por tu gran trabajo, y <strong>claro que quiero celebrarlo</strong>.
          Pero hoy tambi√©n quiero celebrar <strong>c√≥mo eres conmigo</strong>, lo que construimos,
          y que eres mi <strong>futuro marido</strong>.
          As√≠ que‚Ä¶ <strong>hoy mando yo</strong>: te invito a cenar.
        </p>
      </header>

      <main>
        <!-- Welcome -->
        <section class="panel" id="screenWelcome">
          <p class="lead" style="margin:0;">
            Para elegir el sitio, he preparado un juego r√°pido: respondes <strong>A / B / C</strong>
            y al final te sale un <strong>nombre en clave</strong>.
          </p>
          <ul class="rules">
            <li>Son 30 preguntas (s√≠, 30). Te toca disfrutar y obedecer.</li>
            <li>No hace falta pensar demasiado: el instinto tambi√©n invierte bien.</li>
            <li>Al final, yo me encargo de todo.</li>
          </ul>

          <div class="row">
            <button id="btnStart">Empezar</button>
            <button class="ghost" id="btnRestartFromWelcome">Reiniciar</button>
          </div>
        </section>

        <!-- Quiz -->
        <section class="panel" id="screenQuiz" style="display:none;">
          <div class="progress">
            <span id="stepText">Pregunta 1 de 30</span>
            <div class="bar"><div class="fill" id="fill"></div></div>
            <span style="min-width:48px;text-align:right;">A/B/C</span>
          </div>

          <div class="q" id="qText"></div>
          <div class="answers" id="answers"></div>

          <div class="row" style="margin-top:16px;">
            <button class="ghost" id="btnRestart">Reiniciar</button>
          </div>
        </section>

        <!-- Result -->
        <section class="panel" id="screenResult" style="display:none;">
          <div class="q" style="margin:0;">Decisi√≥n aprobada ‚úÖ</div>
          <p class="lead" style="margin:8px 0 0;">
            El comit√© ha decidido tu destino. T√∫ solo tienes una misi√≥n:
            <strong>venir y disfrutar</strong>.
          </p>
          <div class="resultCode" id="resultCode">PROYECTO ???</div>
          <p class="lead" id="resultHint" style="margin:10px 0 0; font-size:14.5px;"></p>
          <div class="row">
            <button id="btnPlayAgain">Jugar otra vez</button>
          </div>
        </section>
      </main>

      <footer>
        <span>Hecho con cari√±o (y estrategia fina).</span>
        <span>¬© Mar√≠a</span>
      </footer>
    </div>
  </div>

  <script>
    // ============================================================
    // 30 preguntas fijas:
    //   - 24 base -> punt√∫an 6 perfiles
    //   - 6 finales -> eligen el PROYECTO final (solo nombre en clave)
    // ============================================================

    const PROFILES = ["PRIME","PLOT","ENERGIA","PRECISION","CONFORT","EVENTO"];
    const TOTAL_QUESTIONS = 30;

    function freshScores(){
      const s = {};
      PROFILES.forEach(p => s[p] = 0);
      return s;
    }
    function addPoints(scores, delta){
      for (const [k,v] of Object.entries(delta)){
        scores[k] = (scores[k] ?? 0) + v;
      }
    }

    // ---------- 24 PREGUNTAS BASE (intereses de Pablo, sin cocina obvia) ----------
    const baseQuestions = [
      { text:"Q1. Hoy, ¬øqu√© te apetece m√°s celebrar?",
        answers:[
          {label:"A", text:"El logro profesional (modo premio)", points:{EVENTO:2}},
          {label:"B", text:"Nosotros (modo pareja)", points:{CONFORT:2}},
          {label:"C", text:"Las dos cosas, pero con estilo", points:{PRIME:1, PRECISION:1}},
        ]},
      { text:"Q2. Si ma√±ana compraras un piso, ¬øqu√© priorizar√≠as?",
        answers:[
          {label:"A", text:"Ubicaci√≥n prime: f√°cil y seguro", points:{PRIME:2}},
          {label:"B", text:"Potencial (value-add): mejorar y ganar valor", points:{PLOT:2}},
          {label:"C", text:"Que funcione perfecto sin dar trabajo", points:{CONFORT:1, PRECISION:1}},
        ]},
      { text:"Q3. ¬øQu√© tipo de noticia te engancha m√°s √∫ltimamente?",
        answers:[
          {label:"A", text:"Econom√≠a/mercados: entender qu√© pasa", points:{PRECISION:2}},
          {label:"B", text:"Actualidad para debatir", points:{PRIME:1, PLOT:1}},
          {label:"C", text:"Ciencia/salud: datos √∫tiles (modo farma)", points:{PRECISION:1, CONFORT:1}},
        ]},
      { text:"Q4. En el cine, ¬øqu√© disfrutas m√°s?",
        answers:[
          {label:"A", text:"Guion perfecto (sin agujeros)", points:{PRECISION:2}},
          {label:"B", text:"Giro bien hecho", points:{PLOT:2}},
          {label:"C", text:"Salir con subid√≥n", points:{ENERGIA:2}},
        ]},
      { text:"Q5. Real Madrid: ¬øqu√© te gusta m√°s ver?",
        answers:[
          {label:"A", text:"Control y estrategia", points:{PRIME:2}},
          {label:"B", text:"Remontada √©pica", points:{EVENTO:2}},
          {label:"C", text:"Ataque constante", points:{ENERGIA:2}},
        ]},
      { text:"Q6. En un reloj, ¬øqu√© te conquista m√°s?",
        answers:[
          {label:"A", text:"Discreci√≥n elegante", points:{PRIME:2}},
          {label:"B", text:"Mecanismo/historia (precisi√≥n bonita)", points:{PRECISION:2}},
          {label:"C", text:"Pieza especial para ocasi√≥n", points:{EVENTO:2}},
        ]},
      { text:"Q7. Ma√±ana hay gym a las 7:00. ¬øC√≥mo quieres levantarte?",
        answers:[
          {label:"A", text:"Ligero y fino", points:{PRECISION:2}},
          {label:"B", text:"Normal, sin drama", points:{CONFORT:2}},
          {label:"C", text:"Con sonrisa: hoy se celebra", points:{EVENTO:2}},
        ]},
      { text:"Q8. Cardio: ¬øqu√© te motiva m√°s?",
        answers:[
          {label:"A", text:"M√©tricas y progreso", points:{PRECISION:2}},
          {label:"B", text:"Constancia tranquila", points:{CONFORT:2}},
          {label:"C", text:"Reto divertido", points:{ENERGIA:2}},
        ]},
      { text:"Q9. Si esta cena fuera una decisi√≥n financiera, ¬øqu√© prefieres?",
        answers:[
          {label:"A", text:"Eficiencia: todo bien atado", points:{PRECISION:2}},
          {label:"B", text:"Ocasi√≥n especial: vale la pena", points:{EVENTO:2}},
          {label:"C", text:"Algo inteligente que sorprende", points:{PLOT:2}},
        ]},
      { text:"Q10. ¬øQu√© te apetece m√°s hoy?",
        answers:[
          {label:"A", text:"Conversaci√≥n tranquila", points:{CONFORT:2}},
          {label:"B", text:"Ambiente vivo (pero agradable)", points:{ENERGIA:2}},
          {label:"C", text:"Un punto ‚Äòwow‚Äô sin estridencias", points:{PRIME:1, EVENTO:1}},
        ]},
      { text:"Q11. En modo CFO, ¬øqu√© estilo te sale m√°s?",
        answers:[
          {label:"A", text:"Directo: vamos al grano", points:{PRECISION:2}},
          {label:"B", text:"Con humor, pero serio", points:{ENERGIA:2}},
          {label:"C", text:"Con clase: firme y elegante", points:{PRIME:2}},
        ]},
      { text:"Q12. De Sri Lanka, ¬øqu√© fue lo mejor para ti?",
        answers:[
          {label:"A", text:"Descubrir cosas nuevas", points:{PLOT:2}},
          {label:"B", text:"Estar bien sin pensar demasiado", points:{CONFORT:2}},
          {label:"C", text:"Las historias y recuerdos", points:{EVENTO:2}},
        ]},
      { text:"Q13. En el cine, si pudieras elegir asiento‚Ä¶",
        answers:[
          {label:"A", text:"Centro perfecto (equilibrio)", points:{PRIME:1, PRECISION:1}},
          {label:"B", text:"Pasillo (pr√°ctico)", points:{PRECISION:2}},
          {label:"C", text:"El mejor disponible de √∫ltima hora", points:{PLOT:2}},
        ]},
      { text:"Q14. ¬øQu√© frase te gustar√≠a decir al salir hoy?",
        answers:[
          {label:"A", text:"Qu√© bien cuidado estaba todo", points:{PRIME:2}},
          {label:"B", text:"Qu√© divertido ha sido", points:{ENERGIA:2}},
          {label:"C", text:"Qu√© sorpresa tan bien pensada", points:{PLOT:2}},
        ]},
      { text:"Q15. Si te doy una bolsa de tus regalices rojas favoritas, ¬øqu√© haces?",
        answers:[
          {label:"A", text:"Una ahora y el resto para luego (control)", points:{CONFORT:1, PRECISION:1}},
          {label:"B", text:"Comparto y adem√°s pruebo algo nuevo hoy", points:{PLOT:2}},
          {label:"C", text:"Hoy es d√≠a especial: me las disfruto", points:{EVENTO:2}},
        ]},
      { text:"Q16. Como CFO, ¬øqu√© te irrita m√°s en un plan?",
        answers:[
          {label:"A", text:"Desorden / falta de criterio", points:{PRECISION:2}},
          {label:"B", text:"Frialdad: cero humanidad", points:{CONFORT:2}},
          {label:"C", text:"Que sea plano: sin emoci√≥n", points:{ENERGIA:1, EVENTO:1}},
        ]},
      { text:"Q17. Boda 2027: ¬øqu√© tono te imaginas m√°s?",
        answers:[
          {label:"A", text:"Cl√°sico elegante", points:{PRIME:2}},
          {label:"B", text:"Emotivo y familiar", points:{CONFORT:2}},
          {label:"C", text:"Fiesta con momentazo", points:{EVENTO:2}},
        ]},
      { text:"Q18. Cuando vivamos en Terrassa, un s√°bado ideal ser√≠a‚Ä¶",
        answers:[
          {label:"A", text:"Tranquilo, calidad sin prisa", points:{CONFORT:2}},
          {label:"B", text:"Con actividad y movimiento", points:{ENERGIA:2}},
          {label:"C", text:"Plan especial de pareja", points:{PRIME:1, EVENTO:1}},
        ]},
      { text:"Q19. En noticias, ¬øqu√© te gusta m√°s hacer?",
        answers:[
          {label:"A", text:"Quedarme con 3 ideas clave", points:{PRECISION:2}},
          {label:"B", text:"Debatir: pros y contras", points:{PLOT:1, PRIME:1}},
          {label:"C", text:"Mandarte el titular ‚Äòesto eres t√∫‚Äô", points:{CONFORT:2}},
        ]},
      { text:"Q20. Si tuvieras que elegir un ‚Äòritual‚Äô semanal, ¬øcu√°l?",
        answers:[
          {label:"A", text:"Plan de pareja fijo (cuidarnos)", points:{CONFORT:2}},
          {label:"B", text:"Plan de celebraci√≥n (como mini-premio)", points:{EVENTO:2}},
          {label:"C", text:"Plan eficiente (r√°pido y perfecto)", points:{PRECISION:2}},
        ]},
      { text:"Q21. En inmobiliario, ¬øqu√© te parece m√°s ‚Äòsexy‚Äô?",
        answers:[
          {label:"A", text:"Una operaci√≥n impecable (papeles perfectos)", points:{PRECISION:2}},
          {label:"B", text:"Detectar una oportunidad antes que otros", points:{PLOT:2}},
          {label:"C", text:"Un activo s√≥lido que da paz", points:{PRIME:2}},
        ]},
      { text:"Q22. Si hoy fuera una pel√≠cula vuestra, ¬øqu√© g√©nero gana?",
        answers:[
          {label:"A", text:"Romcom elegante", points:{CONFORT:2}},
          {label:"B", text:"Heist inteligente (plan maestro)", points:{PLOT:2}},
          {label:"C", text:"√âpica de premio", points:{EVENTO:2}},
        ]},
      { text:"Q23. Cuando alguien te reconoce el trabajo, t√∫ prefieres‚Ä¶",
        answers:[
          {label:"A", text:"Discreci√≥n: gracias y seguimos", points:{PRIME:2}},
          {label:"B", text:"Celebrarlo un poco", points:{EVENTO:2}},
          {label:"C", text:"Que sea significativo, no grande", points:{CONFORT:1, PRECISION:1}},
        ]},
      { text:"Q24. ¬øQu√© te parece un plan perfecto hoy?",
        answers:[
          {label:"A", text:"Elegante y redondo", points:{PRIME:2}},
          {label:"B", text:"Divertido y ligero", points:{ENERGIA:2}},
          {label:"C", text:"Interesante y sorprendente", points:{PLOT:2}},
        ]},
    ];

    // ---------- 6 PREGUNTAS FINALES (siempre 6) ----------
    // En vez de un √°rbol corto, hacemos una ‚Äúsegunda vuelta‚Äù que elige el PROYECTO (solo clave).
    // Aqu√≠ solo salen c√≥digos de proyecto, no nombres reales.
    const finalQuestions = [
      { text:"Q25. Para esta noche, ¬øqu√© te apetece priorizar?",
        answers:[
          {label:"A", text:"Elegancia discreta", map:{PRIME:["ALFA","ORI√ìN","COBALTO","GAMMA"]}},
          {label:"B", text:"Sorpresa con criterio", map:{PLOT:["HELIO","IOTA","THETA","ZETA","ETA"]}},
          {label:"C", text:"Celebraci√≥n con energ√≠a", map:{ENERGIA:["QU√ìRUM","LAMBDA","EPSILON","PI","NU","KAPPA"]}},
        ]},
      { text:"Q26. ¬øC√≥mo quieres sentirte al salir?",
        answers:[
          {label:"A", text:"‚ÄòQu√© nivel‚Äô", map:{PRECISION:["COBALTO","KAPPA","HELIO","MU"]}},
          {label:"B", text:"‚ÄòQu√© bien he estado‚Äô", map:{CONFORT:["DELTA","GAMMA","ORI√ìN","OMICRON","ALFA"]}},
          {label:"C", text:"‚ÄòQu√© planazo‚Äô", map:{EVENTO:["XI","COBALTO","KAPPA","PI","NU","LAMBDA"]}},
        ]},
      { text:"Q27. Si esto fuera un reloj, hoy ser√≠a m√°s‚Ä¶",
        answers:[
          {label:"A", text:"Cl√°sico eterno", map:{PRIME:["ALFA","DELTA","ORI√ìN"]}},
          {label:"B", text:"Pieza especial", map:{EVENTO:["XI","COBALTO","KAPPA"]}},
          {label:"C", text:"Ingenier√≠a bonita", map:{PRECISION:["HELIO","COBALTO","MU","KAPPA"]}},
        ]},
      { text:"Q28. Si esto fuera una inversi√≥n, ¬øqu√© te ilusiona m√°s?",
        answers:[
          {label:"A", text:"Prime seguro", map:{PRIME:["ALFA","DELTA","GAMMA"]}},
          {label:"B", text:"Value-add con cabeza", map:{PLOT:["IOTA","THETA","ZETA","ETA"]}},
          {label:"C", text:"‚ÄòCapricho‚Äô muy bien elegido", map:{EVENTO:["XI","KAPPA","COBALTO","NU"]}},
        ]},
      { text:"Q29. Para un plan de pareja, ¬øqu√© encaja m√°s hoy?",
        answers:[
          {label:"A", text:"√çntimo y bonito", map:{CONFORT:["ORI√ìN","OMICRON","GAMMA","DELTA"]}},
          {label:"B", text:"Elegante y especial", map:{PRIME:["ALFA","COBALTO","XI"]}},
          {label:"C", text:"Divertido y con chispa", map:{ENERGIA:["QU√ìRUM","EPSILON","LAMBDA"]}},
        ]},
      { text:"Q30. √öltima: ¬øqu√© te apetece m√°s ahora mismo?",
        answers:[
          {label:"A", text:"Plan impecable", map:{PRECISION:["COBALTO","HELIO","MU","KAPPA"]}},
          {label:"B", text:"Plan con personalidad", map:{PLOT:["ETA","ZETA","THETA","EPSILON","IOTA"]}},
          {label:"C", text:"Plan de premio", map:{EVENTO:["XI","KAPPA","PI","NU"]}},
        ]},
    ];

    // Para elegir PROYECTO final: acumulamos ‚Äúvotos‚Äù por c√≥digo (solo en finales).
    function freshVotes(){ return {}; }
    function vote(votes, code, n=1){ votes[code] = (votes[code]||0) + n; }
    function pickWinner(votes){
      const entries = Object.entries(votes);
      if (!entries.length) return "PROYECTO ALFA";
      entries.sort((a,b)=> b[1]-a[1]);
      const topScore = entries[0][1];
      const top = entries.filter(e=> e[1]===topScore).map(e=>e[0]);

      // desempate fijo para que sea estable
      const priority = ["COBALTO","KAPPA","ALFA","HELIO","XI","DELTA","GAMMA","ORI√ìN","LAMBDA","QU√ìRUM","ETA","ZETA","THETA","IOTA","MU","OMICRON","EPSILON","PI","NU"];
      top.sort((a,b)=> priority.indexOf(a)-priority.indexOf(b));
      return "PROYECTO " + top[0];
    }

    // ---------- UI ----------
    const screenWelcome = document.getElementById("screenWelcome");
    const screenQuiz = document.getElementById("screenQuiz");
    const screenResult = document.getElementById("screenResult");
    const btnStart = document.getElementById("btnStart");
    const btnRestartFromWelcome = document.getElementById("btnRestartFromWelcome");
    const btnRestart = document.getElementById("btnRestart");
    const btnPlayAgain = document.getElementById("btnPlayAgain");
    const qText = document.getElementById("qText");
    const answersEl = document.getElementById("answers");
    const stepText = document.getElementById("stepText");
    const fill = document.getElementById("fill");
    const resultCode = document.getElementById("resultCode");
    const resultHint = document.getElementById("resultHint");

    let scores, votes, idx, phase, topProfile;

    function reset(){
      scores = freshScores();
      votes = freshVotes();
      idx = 0;
      phase = "welcome"; // welcome | base | final | done
      topProfile = null;

      screenWelcome.style.display = "";
      screenQuiz.style.display = "none";
      screenResult.style.display = "none";
      fill.style.width = "0%";
      stepText.textContent = `Pregunta 1 de ${TOTAL_QUESTIONS}`;
    }

    function showQuiz(){
      phase = "base";
      screenWelcome.style.display = "none";
      screenQuiz.style.display = "";
      screenResult.style.display = "none";
      idx = 0;
      render();
    }

    function computeTopProfile(){
      const entries = Object.entries(scores);
      const max = Math.max(...entries.map(e=>e[1]));
      const top = entries.filter(e=>e[1]===max).map(e=>e[0]);
      const priority = ["EVENTO","PRIME","PRECISION","PLOT","ENERGIA","CONFORT"];
      top.sort((a,b)=> priority.indexOf(a)-priority.indexOf(b));
      return top[0];
    }

    function render(){
      const step = idx + 1;
      stepText.textContent = `Pregunta ${step} de ${TOTAL_QUESTIONS}`;
      fill.style.width = `${Math.round(((step-1)/TOTAL_QUESTIONS)*100)}%`;
      answersEl.innerHTML = "";

      if (phase === "base"){
        const q = baseQuestions[idx];
        qText.textContent = q.text;
        q.answers.forEach(a=>{
          const b = document.createElement("button");
          b.className = "answer";
          b.innerHTML = `<strong>${a.label})</strong> ${a.text}`;
          b.onclick = ()=>{
            addPoints(scores, a.points);
            idx++;
            if (idx >= baseQuestions.length){
              topProfile = computeTopProfile();
              phase = "final";
              idx = baseQuestions.length; // continue counting 25..30
              render();
            } else {
              render();
            }
          };
          answersEl.appendChild(b);
        });
        return;
      }

      if (phase === "final"){
        const finalIdx = idx - baseQuestions.length; // 0..5
        const q = finalQuestions[finalIdx];
        qText.textContent = q.text;

        q.answers.forEach(a=>{
          const b = document.createElement("button");
          b.className = "answer";
          // peque√±o subt√≠tulo para que se note el tono, sin revelar nada
          b.innerHTML = `<strong>${a.label})</strong> ${a.text}<small>Decisi√≥n registrada.</small>`;
          b.onclick = ()=>{
            // Vota por c√≥digos seg√∫n el perfil dominante que sali√≥ en base
            const list = (a.map[topProfile] || []);
            // peso extra al perfil dominante (para que tenga sentido)
            list.forEach(code => vote(votes, code, 2));

            // y un peso ligero a perfiles ‚Äúvecinos‚Äù para que no sea r√≠gido
            // (esto hace el resultado m√°s estable y divertido)
            if (topProfile === "EVENTO" || topProfile === "ENERGIA") {
              (a.map["EVENTO"]||[]).forEach(code=>vote(votes, code, 1));
              (a.map["ENERGIA"]||[]).forEach(code=>vote(votes, code, 1));
            } else if (topProfile === "PRIME" || topProfile === "PRECISION") {
              (a.map["PRIME"]||[]).forEach(code=>vote(votes, code, 1));
              (a.map["PRECISION"]||[]).forEach(code=>vote(votes, code, 1));
            } else {
              (a.map["PLOT"]||[]).forEach(code=>vote(votes, code, 1));
              (a.map["CONFORT"]||[]).forEach(code=>vote(votes, code, 1));
            }

            idx++;
            if (idx >= TOTAL_QUESTIONS){
              finish();
            } else {
              render();
            }
          };
          answersEl.appendChild(b);
        });
        return;
      }
    }

    function finish(){
      phase = "done";
      screenQuiz.style.display = "none";
      screenResult.style.display = "";
      fill.style.width = "100%";

      const code = pickWinner(votes);
      resultCode.textContent = code;

      const lines = {
        PRIME: "Perfil ganador: elegancia tranquila. Hoy toca plan fino y bien elegido.",
        PLOT: "Perfil ganador: sorpresa con criterio. Hoy gana el ‚Äòqu√© buena idea‚Äô.",
        ENERGIA: "Perfil ganador: energ√≠a. Hoy toca disfrutar y re√≠r, sin complicarse.",
        PRECISION: "Perfil ganador: precisi√≥n. Hoy gana el detalle y el buen gusto.",
        CONFORT: "Perfil ganador: confort. Hoy toca estar bien y celebrar lo nuestro.",
        EVENTO: "Perfil ganador: evento. Hoy toca noche de premio, sin medias tintas."
      };
      resultHint.textContent = lines[topProfile] || "Decisi√≥n tomada. Conf√≠a en Mar√≠a.";
    }

    // ---------- buttons ----------
    btnStart.addEventListener("click", showQuiz);
    btnRestartFromWelcome.addEventListener("click", reset);
    btnRestart.addEventListener("click", ()=>{ reset(); showQuiz(); });
    btnPlayAgain.addEventListener("click", ()=>{ reset(); showQuiz(); });

    reset();
  </script>
</body>
</html>
