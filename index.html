<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Operaci√≥n Cena Secreta</title>
  <style>
    :root{
      --bg:#0c0f14;
      --card:#121826;
      --card2:#0f1522;
      --text:#e9eef7;
      --muted:#a9b3c7;
      --gold:#c9a86a;
      --gold2:#b8924a;
      --line:rgba(201,168,106,.22);
      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --radius: 18px;
      --radius2: 14px;
      --maxw: 860px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --serif: ui-serif, Georgia, Cambria, "Times New Roman", Times, serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: var(--font);
      color: var(--text);
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(201,168,106,.16), transparent 60%),
        radial-gradient(900px 600px at 90% 80%, rgba(111,148,255,.12), transparent 55%),
        linear-gradient(180deg, #07090d, var(--bg) 35%, #07090d);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 28px 14px;
    }
    .wrap{
      width:100%;
      max-width: var(--maxw);
    }
    .card{
      background: linear-gradient(180deg, rgba(18,24,38,.92), rgba(10,14,22,.92));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .header{
      padding: 28px 26px 18px;
      border-bottom: 1px solid var(--line);
      background:
        radial-gradient(700px 220px at 15% 0%, rgba(201,168,106,.13), transparent 60%),
        linear-gradient(180deg, rgba(18,24,38,.6), rgba(18,24,38,0));
    }
    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 8px 12px;
      border: 1px solid rgba(201,168,106,.35);
      border-radius: 999px;
      color: var(--gold);
      background: rgba(201,168,106,.08);
      font-weight:600;
      letter-spacing:.2px;
      font-size: 13px;
    }
    .badge .dot{
      width:8px;height:8px;border-radius:99px;background:var(--gold);
      box-shadow: 0 0 0 4px rgba(201,168,106,.12);
    }
    h1{
      margin: 14px 0 6px;
      font-family: var(--serif);
      font-weight: 700;
      letter-spacing: .2px;
      font-size: clamp(24px, 3.2vw, 34px);
      line-height: 1.12;
    }
    .subtitle{
      margin:0;
      color: var(--muted);
      line-height: 1.55;
      font-size: 15.5px;
      max-width: 72ch;
    }

    .content{
      padding: 20px 26px 26px;
    }

    .panel{
      background: linear-gradient(180deg, rgba(15,21,34,.55), rgba(15,21,34,.25));
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius2);
      padding: 18px 16px;
    }
    .rules{
      margin: 10px 0 0;
      padding-left: 18px;
      color: var(--muted);
      line-height: 1.55;
      font-size: 14px;
    }

    .btnrow{
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
      margin-top: 18px;
    }
    button{
      font-family: inherit;
      border-radius: 14px;
      border: 1px solid rgba(201,168,106,.35);
      background: linear-gradient(180deg, rgba(201,168,106,.18), rgba(201,168,106,.06));
      color: var(--text);
      padding: 12px 14px;
      cursor:pointer;
      transition: transform .08s ease, border-color .12s ease, background .12s ease;
      font-weight: 650;
      letter-spacing: .15px;
    }
    button:hover{
      transform: translateY(-1px);
      border-color: rgba(201,168,106,.55);
      background: linear-gradient(180deg, rgba(201,168,106,.24), rgba(201,168,106,.08));
    }
    button:active{
      transform: translateY(0px) scale(.99);
    }
    .btn-primary{
      padding: 12px 18px;
    }
    .btn-ghost{
      border-color: rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-weight: 600;
    }

    .progressWrap{
      margin-top: 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      color: var(--muted);
      font-size: 13px;
    }
    .bar{
      flex:1;
      height: 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.08);
      overflow:hidden;
    }
    .fill{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(201,168,106,.25), rgba(201,168,106,.65));
      border-right: 1px solid rgba(255,255,255,.22);
      transition: width .25s ease;
    }

    .qtitle{
      margin: 0 0 10px;
      font-size: 18px;
      line-height: 1.35;
      font-weight: 720;
    }
    .answers{
      display:grid;
      gap: 10px;
      margin-top: 10px;
    }
    .answer{
      text-align:left;
      width:100%;
      padding: 13px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      color: var(--text);
      font-weight: 620;
    }
    .answer small{
      display:block;
      color: var(--muted);
      font-weight: 520;
      margin-top: 4px;
      line-height: 1.35;
    }
    .answer:hover{
      border-color: rgba(201,168,106,.45);
    }

    .resultCode{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-weight: 800;
      letter-spacing: .6px;
      font-size: 18px;
      color: var(--gold);
      background: rgba(201,168,106,.08);
      border: 1px solid rgba(201,168,106,.25);
      padding: 10px 12px;
      border-radius: 12px;
      display:inline-block;
      margin: 10px 0 0;
    }
    .hint{
      color: var(--muted);
      font-size: 14px;
      line-height: 1.55;
      margin: 10px 0 0;
    }

    .footer{
      padding: 14px 26px 22px;
      border-top: 1px solid var(--line);
      display:flex;
      justify-content:space-between;
      gap: 12px;
      color: rgba(255,255,255,.35);
      font-size: 12.5px;
    }

    @media (max-width:520px){
      .header,.content,.footer{ padding-left:16px; padding-right:16px; }
      .qtitle{font-size: 16.5px;}
      button, .answer{border-radius: 12px;}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="header">
        <div class="badge"><span class="dot"></span> Operaci√≥n Cena Secreta</div>
        <h1 id="heroTitle">Pablo, enhorabuena üèÜ</h1>
        <p class="subtitle" id="heroText">
          Me han dicho que te han dado un premio por tu trabajazo estos √∫ltimos a√±os.
          As√≠ que hoy mando yo: <strong>te invito a cenar</strong>.
          Pero hay una condici√≥n‚Ä¶ no puedes saber a d√≥nde vamos hasta que lleguemos.
        </p>
      </div>

      <div class="content">
        <div class="panel" id="screenWelcome">
          <p class="subtitle" style="margin:0 0 12px;">
            Esto es un mini-juego tipo ‚Äúdue diligence‚Äù: respondes <strong>A/B/C</strong> a preguntas r√°pidas
            (finanzas, cine, noticias, gym 7:00, relojes, Real Madrid‚Ä¶ t√∫ mismo).
          </p>
          <ul class="rules">
            <li>Responde sin pensarlo demasiado (m√°ximo 3 segundos).</li>
            <li>No hay preguntas obvias de ‚Äútipo de cocina‚Äù.</li>
            <li>Al final te sale un <strong>nombre en clave</strong>. El nombre real se revela en la puerta.</li>
          </ul>

          <div class="btnrow">
            <button class="btn-primary" id="btnStart">Empezar</button>
            <button class="btn-ghost" id="btnPreview">Ver reglas otra vez</button>
          </div>
        </div>

        <div class="panel" id="screenQuiz" style="display:none;">
          <div class="progressWrap">
            <span id="stepText">Pregunta 1 de 22</span>
            <div class="bar"><div class="fill" id="fill"></div></div>
            <span id="microHint">A/B/C</span>
          </div>

          <h2 class="qtitle" id="qText" style="margin-top:14px;"></h2>
          <div class="answers" id="answers"></div>

          <div class="btnrow" style="margin-top:16px;">
            <button class="btn-ghost" id="btnRestart">Reiniciar</button>
          </div>
        </div>

        <div class="panel" id="screenResult" style="display:none;">
          <h2 class="qtitle" style="margin:0;">Resultado aprobado ‚úÖ</h2>
          <p class="subtitle" style="margin:6px 0 0;">
            El comit√© ha decidido tu destino. El nombre real se revela <strong>solo al llegar</strong>.
          </p>
          <div class="resultCode" id="resultCode">PROYECTO ???</div>
          <p class="hint" id="resultHint">
            Instrucci√≥n: Mar√≠a anunciar√° el nombre en clave y t√∫ solo tienes que confiar.
          </p>

          <div class="btnrow">
            <button class="btn-primary" id="btnPlayAgain">Jugar otra vez</button>
          </div>
        </div>
      </div>

      <div class="footer">
        <span>Hecho con cari√±o (y un poquito de estrategia).</span>
        <span>¬© Mar√≠a</span>
      </div>
    </div>
  </div>

  <script>
    // -----------------------------
    // 1) Perfiles y puntuaci√≥n
    // -----------------------------
    const PROFILES = ["PRIME","PLOT","ENERGIA","PRECISION","CONFORT","EVENTO"];

    function freshScores(){
      const s = {};
      PROFILES.forEach(p => s[p] = 0);
      return s;
    }

    function addPoints(scores, delta){
      for (const [k,v] of Object.entries(delta)){
        scores[k] = (scores[k] ?? 0) + v;
      }
    }

    // -----------------------------
    // 2) Preguntas base (18 fijas)
    //    Cada respuesta a√±ade puntos.
    // -----------------------------
    const baseQuestions = [
      {
        id:"Q1",
        text:"Q1. Hoy, ¬øqu√© te apetece m√°s celebrar?",
        answers:[
          {label:"A", text:"El logro profesional (modo premio)", points:{EVENTO:2}},
          {label:"B", text:"Que estemos a gusto (modo pareja)", points:{CONFORT:2}},
          {label:"C", text:"Las dos cosas, pero con estilo", points:{PRIME:1, PRECISION:1}},
        ]
      },
      {
        id:"Q2",
        text:"Q2. Si ma√±ana compraras un piso, ¬øqu√© priorizar√≠as?",
        answers:[
          {label:"A", text:"Ubicaci√≥n prime: f√°cil y seguro", points:{PRIME:2}},
          {label:"B", text:"Potencial: mejorarlo y ganar valor", points:{PLOT:2}},
          {label:"C", text:"Que funcione perfecto sin trabajo", points:{CONFORT:1, PRECISION:1}},
        ]
      },
      {
        id:"Q3",
        text:"Q3. ¬øQu√© tipo de noticia te engancha m√°s √∫ltimamente?",
        answers:[
          {label:"A", text:"Econom√≠a/mercados: entender qu√© pasa", points:{PRECISION:2}},
          {label:"B", text:"Actualidad para debatir y opinar", points:{PRIME:1, PLOT:1}},
          {label:"C", text:"Ciencia/salud: datos √∫tiles (modo farma)", points:{PRECISION:1, CONFORT:1}},
        ]
      },
      {
        id:"Q4",
        text:"Q4. En el cine, ¬øqu√© disfrutas m√°s?",
        answers:[
          {label:"A", text:"Guion perfecto: sin agujeros", points:{PRECISION:2}},
          {label:"B", text:"Giro bien hecho: ‚Äòno me lo vi venir‚Äô", points:{PLOT:2}},
          {label:"C", text:"Salir con subid√≥n y ganas de aplaudir", points:{ENERGIA:2}},
        ]
      },
      {
        id:"Q5",
        text:"Q5. Real Madrid: ¬øqu√© te gusta m√°s ver en un partido?",
        answers:[
          {label:"A", text:"Control y estrategia", points:{PRIME:2}},
          {label:"B", text:"Remontada √©pica", points:{EVENTO:2}},
          {label:"C", text:"Ataque constante y emoci√≥n", points:{ENERGIA:2}},
        ]
      },
      {
        id:"Q6",
        text:"Q6. En un reloj, ¬øqu√© te conquista m√°s?",
        answers:[
          {label:"A", text:"Discreci√≥n elegante", points:{PRIME:2}},
          {label:"B", text:"Mecanismo/historia: precisi√≥n bonita", points:{PRECISION:2}},
          {label:"C", text:"Pieza especial para una ocasi√≥n", points:{EVENTO:2}},
        ]
      },
      {
        id:"Q7",
        text:"Q7. Ma√±ana hay gym a las 7:00. ¬øC√≥mo quieres levantarte?",
        answers:[
          {label:"A", text:"Ligero y fino", points:{PRECISION:2}},
          {label:"B", text:"Normal, sin drama", points:{CONFORT:2}},
          {label:"C", text:"Con una sonrisa: hoy se celebra", points:{EVENTO:2}},
        ]
      },
      {
        id:"Q8",
        text:"Q8. Para hacer m√°s cardio, ¬øqu√© te motiva m√°s?",
        answers:[
          {label:"A", text:"M√©tricas y progreso (ritmo, zonas‚Ä¶)", points:{PRECISION:2}},
          {label:"B", text:"Constancia tranquila: lo que se sostiene", points:{CONFORT:2}},
          {label:"C", text:"Reto divertido: ‚Äòvenga, una m√°s‚Äô", points:{ENERGIA:2}},
        ]
      },
      {
        id:"Q9",
        text:"Q9. Si esta cena fuera una decisi√≥n financiera, ¬øqu√© prefieres?",
        answers:[
          {label:"A", text:"Eficiencia: todo bien atado", points:{PRECISION:2}},
          {label:"B", text:"Ocasi√≥n especial: ‚Äòvale cada minuto‚Äô", points:{EVENTO:2}},
          {label:"C", text:"Algo inteligente que sorprende para bien", points:{PLOT:2}},
        ]
      },
      {
        id:"Q10",
        text:"Q10. ¬øQu√© te apetece m√°s hoy?",
        answers:[
          {label:"A", text:"Conversaci√≥n tranquila sin interrupciones", points:{CONFORT:2}},
          {label:"B", text:"Ambiente vivo (pero agradable)", points:{ENERGIA:2}},
          {label:"C", text:"Un punto ‚Äòwow‚Äô sin estridencias", points:{PRIME:1, EVENTO:1}},
        ]
      },
      {
        id:"Q11",
        text:"Q11. En modo ‚Äòdirector financiero‚Äô en una reuni√≥n, ¬øqu√© estilo te sale m√°s?",
        answers:[
          {label:"A", text:"Directo: ‚Äòvamos al grano‚Äô", points:{PRECISION:2}},
          {label:"B", text:"Con humor: tensi√≥n cero, foco igual", points:{ENERGIA:2}},
          {label:"C", text:"Con clase: firme pero elegante", points:{PRIME:2}},
        ]
      },
      {
        id:"Q12",
        text:"Q12. De Sri Lanka, ¬øqu√© fue lo mejor para ti?",
        answers:[
          {label:"A", text:"Descubrir cosas nuevas", points:{PLOT:2}},
          {label:"B", text:"Estar bien sin pensar demasiado", points:{CONFORT:2}},
          {label:"C", text:"Las historias y recuerdos que te quedan", points:{EVENTO:2}},
        ]
      },
      {
        id:"Q13",
        text:"Q13. En el cine, ¬øqu√© asiento elegir√≠as si pudieras?",
        answers:[
          {label:"A", text:"Centro perfecto: equilibrio", points:{PRIME:1, PRECISION:1}},
          {label:"B", text:"Pasillo: pr√°ctico y r√°pido", points:{PRECISION:2}},
          {label:"C", text:"El ‚Äòmejor disponible‚Äô de √∫ltima hora", points:{PLOT:2}},
        ]
      },
      {
        id:"Q14",
        text:"Q14. ¬øQu√© frase te gustar√≠a decir al salir hoy?",
        answers:[
          {label:"A", text:"‚ÄòQu√© bien cuidado estaba todo‚Äô", points:{PRIME:2}},
          {label:"B", text:"‚ÄòQu√© divertido ha sido‚Äô", points:{ENERGIA:2}},
          {label:"C", text:"‚ÄòQu√© sorpresa tan bien pensada‚Äô", points:{PLOT:2}},
        ]
      },
      {
        id:"Q15",
        text:"Q15. Si te doy una bolsa de tus regalices rojas favoritas, ¬øqu√© har√≠as?",
        answers:[
          {label:"A", text:"Me como una y la guardo para luego (control total)", points:{CONFORT:1, PRECISION:1}},
          {label:"B", text:"La comparto y adem√°s pruebo algo distinto hoy", points:{PLOT:2}},
          {label:"C", text:"Me la acabo feliz: hoy es d√≠a de premio", points:{EVENTO:2}},
        ]
      },
      {
        id:"Q16",
        text:"Q16. Como CFO, ¬øqu√© te irrita m√°s en un plan?",
        answers:[
          {label:"A", text:"Desorden / falta de criterio", points:{PRECISION:2}},
          {label:"B", text:"Frialdad: cero humanidad", points:{CONFORT:2}},
          {label:"C", text:"Que sea plano: sin emoci√≥n", points:{ENERGIA:1, EVENTO:1}},
        ]
      },
      {
        id:"Q17",
        text:"Q17. Para la boda 2027, ¬øqu√© tono te imaginas m√°s?",
        answers:[
          {label:"A", text:"Cl√°sico elegante", points:{PRIME:2}},
          {label:"B", text:"Emotivo y familiar", points:{CONFORT:2}},
          {label:"C", text:"Fiesta con momentazo", points:{EVENTO:2}},
        ]
      },
      {
        id:"Q18",
        text:"Q18. Cuando vivamos en Terrassa, un s√°bado ideal ser√≠a‚Ä¶",
        answers:[
          {label:"A", text:"Tranquilo, calidad sin prisa", points:{CONFORT:2}},
          {label:"B", text:"Con actividad y movimiento", points:{ENERGIA:2}},
          {label:"C", text:"Plan especial de pareja", points:{PRIME:1, EVENTO:1}},
        ]
      },
    ];

    // Tie-breaker (solo si hay empate tras Q18)
    const tieBreaker = {
      id:"Q19",
      text:"Q19 (desempate). ¬øQu√© prefieres que pase hoy s√≠ o s√≠?",
      answers:[
        {label:"A", text:"Que salga todo impecable", points:{PRIME:2}},
        {label:"B", text:"Que os sorprenda para bien", points:{PLOT:2}},
        {label:"C", text:"Que sea un momentazo", points:{EVENTO:2}},
      ]
    };

    // -----------------------------
    // 3) Finales (√°rbol corto por perfil ganador)
    // Cada final termina en un CODENAME.
    // (No incluimos aqu√≠ la chuleta de restaurantes reales para que Pablo no la vea.)
    // -----------------------------
    const finals = {
      PRIME: [
        {
          id:"Q20P",
          text:"Q20. ¬øQu√© tipo de elegancia te apetece hoy?",
          answers:[
            {label:"A", text:"Discreci√≥n total", next:"Q21P"},
            {label:"B", text:"Elegancia moderna", next:"Q22P"},
            {label:"C", text:"Elegancia con ‚Äòtoque especial‚Äô", next:"Q23P"},
          ]
        },
        {
          id:"Q21P",
          text:"Q21. ¬øTe gustan m√°s los planes‚Ä¶?",
          answers:[
            {label:"A", text:"Muy √≠ntimos", result:"PROYECTO ORI√ìN"},
            {label:"B", text:"Muy redondos y cuidados", result:"PROYECTO ALFA"},
            {label:"C", text:"(No hay C) ‚Äî el comit√© te ve indeciso üòÑ", result:"PROYECTO ALFA"}
          ]
        },
        {
          id:"Q22P",
          text:"Q22. Hoy te tira m√°s‚Ä¶",
          answers:[
            {label:"A", text:"Ciudad y contempor√°neo", result:"PROYECTO GAMMA"},
            {label:"B", text:"Cl√°sico con personalidad", result:"PROYECTO DELTA"},
            {label:"C", text:"Algo impecable y top", result:"PROYECTO COBALTO"},
          ]
        },
        {
          id:"Q23P",
          text:"Q23. El detalle que te gana es‚Ä¶",
          answers:[
            {label:"A", text:"Servicio fin√≠simo", result:"PROYECTO COBALTO"},
            {label:"B", text:"Est√©tica y glamour", result:"PROYECTO XI"},
            {label:"C", text:"Ambiente muy cuidado", result:"PROYECTO ORI√ìN"},
          ]
        },
      ],

      PLOT: [
        {
          id:"Q20L",
          text:"Q20. ¬øQu√© tipo de sorpresa te gusta m√°s?",
          answers:[
            {label:"A", text:"‚ÄòNo lo habr√≠a elegido yo, y me encanta‚Äô", next:"Q21L"},
            {label:"B", text:"‚ÄòMe hace gracia y tiene rollo‚Äô", next:"Q22L"},
            {label:"C", text:"‚ÄòMe sorprende por nivel‚Äô", next:"Q23L"},
          ]
        },
        {
          id:"Q21L",
          text:"Q21. ¬øLa sorpresa te gusta m√°s tipo‚Ä¶?",
          answers:[
            {label:"A", text:"‚ÄòViaje sin moverse‚Äô", result:"PROYECTO ETA"},
            {label:"B", text:"Mezcla inesperada", result:"PROYECTO IOTA"},
            {label:"C", text:"Un giro creativo", result:"PROYECTO THETA"},
          ]
        },
        {
          id:"Q22L",
          text:"Q22. ¬øTe apetece un punto m√°s‚Ä¶?",
          answers:[
            {label:"A", text:"Urbano y travieso", result:"PROYECTO EPSILON"},
            {label:"B", text:"Barrio con car√°cter", result:"PROYECTO ZETA"},
            {label:"C", text:"Divertido y moderno", result:"PROYECTO LAMBDA"},
          ]
        },
        {
          id:"Q23L",
          text:"Q23. ¬øQu√© te gana m√°s: creatividad o perfecci√≥n?",
          answers:[
            {label:"A", text:"Creatividad medida", result:"PROYECTO HELIO"},
            {label:"B", text:"Giro inesperado", result:"PROYECTO THETA"},
            {label:"C", text:"Nivel alt√≠simo sin ruido", result:"PROYECTO COBALTO"},
          ]
        },
      ],

      ENERGIA: [
        {
          id:"Q20E",
          text:"Q20. ¬øC√≥mo quieres el ambiente hoy?",
          answers:[
            {label:"A", text:"Animado pero c√≥modo", next:"Q21E"},
            {label:"B", text:"Animado y potente", next:"Q22E"},
            {label:"C", text:"Animado y moderno", next:"Q23E"},
          ]
        },
        {
          id:"Q21E",
          text:"Q21. ¬øQu√© tipo de plan te hace m√°s feliz hoy?",
          answers:[
            {label:"A", text:"Risas + comer muy bien", result:"PROYECTO QU√ìRUM"},
            {label:"B", text:"Energ√≠a con toque sofisticado", result:"PROYECTO KAPPA"},
            {label:"C", text:"Algo distinto pero f√°cil de disfrutar", result:"PROYECTO EPSILON"},
          ]
        },
        {
          id:"Q22E",
          text:"Q22. Para celebrar, ¬øqu√© te apetece m√°s?",
          answers:[
            {label:"A", text:"Sensaci√≥n de fest√≠n", result:"PROYECTO PI"},
            {label:"B", text:"Plan con car√°cter y brasa elegante", result:"PROYECTO NU"},
            {label:"C", text:"Plan moderno y con ritmo", result:"PROYECTO LAMBDA"},
          ]
        },
        {
          id:"Q23E",
          text:"Q23. ¬øLo prefieres m√°s‚Ä¶?",
          answers:[
            {label:"A", text:"Moderno con ritmo", result:"PROYECTO LAMBDA"},
            {label:"B", text:"Con chispa creativa", result:"PROYECTO EPSILON"},
            {label:"C", text:"Con final ‚Äòwow‚Äô", result:"PROYECTO KAPPA"},
          ]
        },
      ],

      PRECISION: [
        {
          id:"Q20R",
          text:"Q20. ¬øC√≥mo te gusta que est√© dise√±ado el plan?",
          answers:[
            {label:"A", text:"Foco y claridad", next:"Q21R"},
            {label:"B", text:"Producto impecable", next:"Q22R"},
            {label:"C", text:"Un guion perfecto (sin relleno)", next:"Q23R"},
          ]
        },
        {
          id:"Q21R",
          text:"Q21. ¬øTe apetece algo m√°s‚Ä¶?",
          answers:[
            {label:"A", text:"Peque√±o y afinado", result:"PROYECTO OMICRON"},
            {label:"B", text:"Contempor√°neo y medido", result:"PROYECTO GAMMA"},
            {label:"C", text:"Elegante sin ruido", result:"PROYECTO ALFA"},
          ]
        },
        {
          id:"Q22R",
          text:"Q22. ¬øPrefieres precisi√≥n con‚Ä¶?",
          answers:[
            {label:"A", text:"Nivel premium y muy cuidado", result:"PROYECTO COBALTO"},
            {label:"B", text:"Personalidad y producto", result:"PROYECTO MU"},
            {label:"C", text:"Final de ‚Äòqu√© nivel‚Äô", result:"PROYECTO KAPPA"},
          ]
        },
        {
          id:"Q23R",
          text:"Q23. ¬øTe apetece precisi√≥n con‚Ä¶?",
          answers:[
            {label:"A", text:"Creatividad bien medida", result:"PROYECTO HELIO"},
            {label:"B", text:"Mezcla de estilos con sentido", result:"PROYECTO KAPPA"},
            {label:"C", text:"Redondez absoluta", result:"PROYECTO DELTA"},
          ]
        },
      ],

      CONFORT: [
        {
          id:"Q20C",
          text:"Q20. ¬øQu√© plan te encaja m√°s hoy?",
          answers:[
            {label:"A", text:"Hablar tranquilos y salir felices", next:"Q21C"},
            {label:"B", text:"Comodidad total: cero pensar", next:"Q22C"},
            {label:"C", text:"Acogedor pero con nivel", next:"Q23C"},
          ]
        },
        {
          id:"Q21C",
          text:"Q21. ¬øTu confort es m√°s‚Ä¶?",
          answers:[
            {label:"A", text:"C√°lido y con alma", result:"PROYECTO DELTA"},
            {label:"B", text:"Bistr√≥ c√≥modo y elegante", result:"PROYECTO GAMMA"},
            {label:"C", text:"Pareja tranquila, plan fino", result:"PROYECTO ALFA"},
          ]
        },
        {
          id:"Q22C",
          text:"Q22. ¬øPrefieres confort‚Ä¶?",
          answers:[
            {label:"A", text:"Peque√±o y tranquilo", result:"PROYECTO OMICRON"},
            {label:"B", text:"Tranquilo pero con car√°cter", result:"PROYECTO ORI√ìN"},
            {label:"C", text:"Con chispa sin ruido", result:"PROYECTO GAMMA"},
          ]
        },
        {
          id:"Q23C",
          text:"Q23. ¬øQu√© te gana m√°s hoy?",
          answers:[
            {label:"A", text:"Sensaci√≥n de ‚Äòhogar pro‚Äô", result:"PROYECTO DELTA"},
            {label:"B", text:"Sensaci√≥n de ‚Äòpareja premium‚Äô", result:"PROYECTO ALFA"},
            {label:"C", text:"Redondez y calma", result:"PROYECTO ORI√ìN"},
          ]
        },
      ],

      EVENTO: [
        {
          id:"Q20V",
          text:"Q20. ¬øQu√© tipo de ‚Äòevento‚Äô quieres que sea la noche?",
          answers:[
            {label:"A", text:"Glamour e impacto", next:"Q21V"},
            {label:"B", text:"Nivel gastron√≥mico", next:"Q22V"},
            {label:"C", text:"Celebraci√≥n contundente", next:"Q23V"},
          ]
        },
        {
          id:"Q21V",
          text:"Q21. Para ti, glamour es‚Ä¶",
          answers:[
            {label:"A", text:"Plan grande con est√©tica top", result:"PROYECTO XI"},
            {label:"B", text:"Elegancia discreta de alt√≠simo nivel", result:"PROYECTO COBALTO"},
            {label:"C", text:"Celebraci√≥n fina sin ruido", result:"PROYECTO ALFA"},
          ]
        },
        {
          id:"Q22V",
          text:"Q22. Para ti, nivel gastron√≥mico es‚Ä¶",
          answers:[
            {label:"A", text:"Producto premium impecable", result:"PROYECTO KAPPA"},
            {label:"B", text:"T√©cnica + creatividad bien pensada", result:"PROYECTO HELIO"},
            {label:"C", text:"Plan perfecto y redondo", result:"PROYECTO DELTA"},
          ]
        },
        {
          id:"Q23V",
          text:"Q23. Para celebrar a lo grande, ¬øqu√© te apetece m√°s?",
          answers:[
            {label:"A", text:"Potencia y brasa", result:"PROYECTO PI"},
            {label:"B", text:"Car√°cter con final ‚Äòwow‚Äô", result:"PROYECTO NU"},
            {label:"C", text:"Energ√≠a moderna", result:"PROYECTO LAMBDA"},
          ]
        },
      ],
    };

    // -----------------------------
    // 4) UI + Motor del test
    // -----------------------------
    const screenWelcome = document.getElementById("screenWelcome");
    const screenQuiz = document.getElementById("screenQuiz");
    const screenResult = document.getElementById("screenResult");

    const btnStart = document.getElementById("btnStart");
    const btnPreview = document.getElementById("btnPreview");
    const btnRestart = document.getElementById("btnRestart");
    const btnPlayAgain = document.getElementById("btnPlayAgain");

    const qText = document.getElementById("qText");
    const answersEl = document.getElementById("answers");
    const stepText = document.getElementById("stepText");
    const fill = document.getElementById("fill");
    const resultCode = document.getElementById("resultCode");
    const resultHint = document.getElementById("resultHint");

    let scores, phase, baseIndex, currentFinalId, finalProfile, tieAsked;

    function resetGame(){
      scores = freshScores();
      phase = "welcome";     // welcome | base | tie | final | done
      baseIndex = 0;
      currentFinalId = null;
      finalProfile = null;
      tieAsked = false;

      screenWelcome.style.display = "";
      screenQuiz.style.display = "none";
      screenResult.style.display = "none";
    }

    function showQuiz(){
      screenWelcome.style.display = "none";
      screenQuiz.style.display = "";
      screenResult.style.display = "none";
      phase = "base";
      render();
    }

    function getProgress(){
      // total steps shown to user: 18 base + (0/1 tie) + 3 final approx.
      // We'll compute dynamically for a smooth bar.
      let shown = 0;
      if (phase === "base") shown = baseIndex;
      if (phase === "tie") shown = 18;
      if (phase === "final") shown = 18 + (tieAsked ? 1 : 0) + countFinalAnswered();
      if (phase === "done") shown = 18 + (tieAsked ? 1 : 0) + 3;
      const total = 22; // target feel (21-22)
      return {shown, total};
    }

    function countFinalAnswered(){
      // We can approximate by counting how many final questions we've advanced past.
      // For UI purposes only.
      if (!currentFinalId) return 0;
      const list = finals[finalProfile] || [];
      const idx = list.findIndex(q => q.id === currentFinalId);
      return Math.max(0, idx);
    }

    function render(){
      const {shown, total} = getProgress();
      const stepNumber = Math.min(shown + 1, total);
      stepText.textContent = `Pregunta ${stepNumber} de ${total}`;
      fill.style.width = `${Math.min(100, Math.round((shown/total)*100))}%`;

      answersEl.innerHTML = "";

      if (phase === "base"){
        const q = baseQuestions[baseIndex];
        qText.textContent = q.text;
        q.answers.forEach((a) => {
          const btn = document.createElement("button");
          btn.className = "answer";
          btn.innerHTML = `<strong>${a.label})</strong> ${a.text}`;
          btn.onclick = () => {
            addPoints(scores, a.points);
            baseIndex++;
            if (baseIndex >= baseQuestions.length){
              decideAfterBase();
            } else {
              render();
            }
          };
          answersEl.appendChild(btn);
        });
        return;
      }

      if (phase === "tie"){
        qText.textContent = tieBreaker.text;
        tieBreaker.answers.forEach(a => {
          const btn = document.createElement("button");
          btn.className = "answer";
          btn.innerHTML = `<strong>${a.label})</strong> ${a.text}`;
          btn.onclick = () => {
            addPoints(scores, a.points);
            tieAsked = true;
            decideFinalProfile(); // now pick profile and start finals
          };
          answersEl.appendChild(btn);
        });
        return;
      }

      if (phase === "final"){
        const q = (finals[finalProfile] || []).find(x => x.id === currentFinalId);
        if (!q){
          // safety fallback
          finishWith("PROYECTO ALFA");
          return;
        }
        qText.textContent = q.text;
        q.answers.forEach(a => {
          const btn = document.createElement("button");
          btn.className = "answer";
          btn.innerHTML = `<strong>${a.label})</strong> ${a.text}`;
          btn.onclick = () => {
            if (a.result){
              finishWith(a.result);
            } else if (a.next){
              currentFinalId = a.next;
              render();
            } else {
              finishWith("PROYECTO ALFA");
            }
          };
          answersEl.appendChild(btn);
        });
        return;
      }
    }

    function decideAfterBase(){
      // Determine top score(s)
      const entries = Object.entries(scores);
      const max = Math.max(...entries.map(e => e[1]));
      const top = entries.filter(e => e[1] === max).map(e => e[0]);

      if (top.length === 1){
        finalProfile = top[0];
        startFinal();
      } else {
        // Ask tie breaker
        phase = "tie";
        render();
      }
    }

    function decideFinalProfile(){
      const entries = Object.entries(scores);
      const max = Math.max(...entries.map(e => e[1]));
      const top = entries.filter(e => e[1] === max).map(e => e[0]);

      // If still tied, pick the one that appears first in this priority list.
      const priority = ["EVENTO","PRIME","PRECISION","PLOT","ENERGIA","CONFORT"];
      finalProfile = top.sort((a,b) => priority.indexOf(a) - priority.indexOf(b))[0];
      startFinal();
    }

    function startFinal(){
      phase = "final";
      // pick first node of that profile
      const list = finals[finalProfile] || [];
      currentFinalId = list.length ? list[0].id : null;
      render();
    }

    function finishWith(code){
      phase = "done";
      screenQuiz.style.display = "none";
      screenWelcome.style.display = "none";
      screenResult.style.display = "";
      resultCode.textContent = code;

      // A little tailored closing line based on profile:
      const closing = {
        PRIME: "Destino con elegancia, de los que un reloj discreto aprobar√≠a.",
        PLOT: "Destino con giro inteligente: hoy gana el ‚Äòno me lo esperaba‚Äô.",
        ENERGIA: "Destino con ritmo: celebraci√≥n con sonrisa garantizada.",
        PRECISION: "Destino de precisi√≥n: criterio y detalle, como te gusta.",
        CONFORT: "Destino para hablar y estar bien: pareja y futuro en modo bonito.",
        EVENTO: "Destino ‚Äòpremio‚Äô: hoy toca plan grande, sin medias tintas."
      };
      resultHint.textContent = closing[finalProfile] || "Destino asignado. Conf√≠a en Mar√≠a.";

      // reset progress bar to 100
      fill.style.width = "100%";
    }

    // -----------------------------
    // 5) Botones
    // -----------------------------
    btnStart.addEventListener("click", () => {
      showQuiz();
    });

    btnPreview.addEventListener("click", () => {
      // just re-shows the welcome, nothing else
      screenWelcome.scrollIntoView({behavior:"smooth", block:"start"});
    });

    btnRestart.addEventListener("click", () => {
      resetGame();
      showQuiz();
    });

    btnPlayAgain.addEventListener("click", () => {
      resetGame();
      showQuiz();
    });

    // init
    resetGame();
  </script>
</body>
</html>
